"use strict";angular.module("gps",["ngRoute","leaflet-directive"]).config(["$locationProvider",function(a){a.html5Mode(!1)}]),$(window.document).ready(function(){$(".sidebar").sidebar({overlay:!0})});var app=angular.module("gps");app.controller("MapController",["$scope","$http","$timeout","$location","$routeParams","$q","leafletBoundsHelpers",function(a,b,c,d,e,f,g){angular.extend(a,{center:{lat:40.000531,lng:-.039139,zoom:12},nodes:{},links:{},linksPromise:f.defer(),nodesPromise:f.defer(),bounds:[],layers:{baselayers:{googleHybrid:{name:"Google Hybrid",layerType:"HYBRID",type:"google"},osm:{name:"OpenStreetMap",url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",type:"xyz"}}}});var h={0:"#491",1:"#FFFF00",2:"#FF8800",3:"#FF0000"},i=function(b){return{lat:a.nodes[b].lat,lng:a.nodes[b].lng}},j=function(b){$(".sidebar").sidebar("show"),a.active=b};a.closeSidebar=function(){$(".sidebar").sidebar("hide")},a.$on("$routeChangeSuccess",function(b,c){angular.isDefined(c.params.node)?a.nodesPromise.promise.then(function(a){j(a[c.params.node])}):angular.isDefined(c.params.n1)&&a.linksPromise.promise.then(function(a){j(a[c.params.n1+"_"+c.params.n2])}),$(".sidebar").sidebar({overlay:!0})}),a.$on("leafletDirectivePath.mouseout",function(b,c){if(0!==d.path().indexOf("/path")){var c=a.links[c.pathName];a.active&&a.active.name===c.name||(c.color=c.activeColor)}}),a.$on("leafletDirectivePath.mouseover",function(b,c){if(0!==d.path().indexOf("/path")){var c=a.links[c.pathName];c.color="#FFF"}}),a.$on("leafletDirectivePath.click",function(b,c){var e=a.nodes[c.pathName.split("_")[0]],f=a.nodes[c.pathName.split("_")[1]];a.bounds=g.createBoundsFromArray([[e.lat,e.lng],[f.lat,f.lng]]),d.url("/link/"+c.pathName.replace("_","/"))}),a.$on("leafletDirectiveMarker.click",function(b,c){var c=a.nodes[c.markerName];a.center.lat=c.lat,a.center.lng=c.lng,d.url("/node/"+c.name)}),b.get("/api/node/").success(function(c){for(var d in c){var e=c[d],f="<strong>"+e.name+" ("+e.ip+")</strong>",g={icon:{type:"awesomeMarker",icon:"fa-star",color:e.alive?"blue":"red",prefix:"fa",shape:"circle",labelAnchor:[10,-24]},label:{message:f,direction:"auto"},riseOnHover:!0,lat:e.lat,lng:e.lng,name:e.name,node:e};a.nodes[e.name]=g}a.nodesPromise.resolve(a.nodes),b.get("/api/link/").success(function(b){angular.forEach(b,function(b){var c=b.nodes[0],d=b.nodes[1],e=i(c.name),g=i(d.name),j=b.bandwidth/5+2;j>10&&(j=10),f='<img style="width: 380px;" src="/graph/bandwidth/'+c.name+"/"+d.name+'">',f='<img style="width: 380px;" src="http://gps.qui.guifi.net/graph/bandwidth/acometidas/bartolo">',a.links[c.name+"_"+d.name]={id:b._id,type:"polyline",weight:j,color:h[b.saturation],activeColor:h[b.saturation],saturation:b.saturation,label:{message:f},opacity:.9,name:c.name+"-"+d.name,distance:b.distance,nodes:[b.nodes[0].name,b.nodes[1].name],latlngs:[e,g],link:{n1:c,n2:d}},a.linksPromise.resolve(a.links)})})})}]);var app=angular.module("gps");app.controller("NodeController",["$scope","$routeParams","$http",function(a,b,c){a.$on("$routeChangeSuccess",function(b,d){console.log(d);var e=d.params.node;c.get("/api/node/"+e).success(function(b){console.log(b),a.node=b})})}]);