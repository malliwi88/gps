"use strict";angular.module("gps",["ngRoute","leaflet-directive"]).config(["$locationProvider",function(a){a.html5Mode(!1)}]),$(window.document).ready(function(){$(".sidebar").sidebar({overlay:!0})});var app=angular.module("gps");app.controller("MapController",["$scope","$http","$timeout","$location","$routeParams","$q","leafletBoundsHelpers",function(a,b,c,d,e,f,g){b.get("json/center.json").success(function(b){a.center=b.center}),angular.extend(a,{center:{},nodes:{},paths:{},linksPromise:f.defer(),nodesPromise:f.defer(),bounds:[],layers:{baselayers:{googleHybrid:{name:"Google Hybrid",layerType:"HYBRID",type:"google"},osm:{name:"OpenStreetMap",url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",type:"xyz"}}}});var h={0:"#491",1:"#FFFF00",2:"#FF8800",3:"#FF0000"},i=function(b){return{lat:a.nodes[b].lat,lng:a.nodes[b].lng}},j=function(b){$(".sidebar").sidebar("show"),a.active=b};a.closeSidebar=function(){$(".sidebar").sidebar("hide")},a.$on("$routeChangeSuccess",function(b,c){angular.isDefined(c.params.node)?a.nodesPromise.promise.then(function(a){j(a[c.params.node])}):angular.isDefined(c.params.n1)&&a.linksPromise.promise.then(function(a){j(a[c.params.n1+"_"+c.params.n2])}),$(".sidebar").sidebar({overlay:!0})}),a.$on("leafletDirectivePath.mouseout",function(b,c){if(0!==d.path().indexOf("/path")){var e=a.paths[c.modelName];a.active&&a.active.name===e.name||(e.color=e.activeColor)}}),a.$on("leafletDirectivePath.mouseover",function(b,c){if(0!==d.path().indexOf("/path")){var e=a.paths[c.modelName];e.color="#FFF"}}),a.$on("leafletDirectivePath.click",function(b,c){console.log("click",c.modelName);var e=a.nodes[c.modelName.split("_")[0]],f=a.nodes[c.modelName.split("_")[1]];a.bounds=g.createBoundsFromArray([[e.lat,e.lng],[f.lat,f.lng]]),d.url("/link/"+c.modelName.replace("_","/"))}),a.$on("leafletDirectiveMarker.click",function(b,c){var e=a.nodes[c.modelName];a.center.lat=e.lat,a.center.lng=e.lng,d.url("/node/"+e.name)}),b.get("/api/node/").success(function(c){for(var d in c){var e=c[d],f="<strong>"+e.name+" ("+e.ip+")</strong>",g={icon:{type:"awesomeMarker",icon:"fa-star",color:e.alive?"blue":"red",prefix:"fa",shape:"circle",labelAnchor:[10,-24]},label:{message:f,direction:"auto"},riseOnHover:!0,lat:e.lat,lng:e.lng,name:e.name,node:e};a.nodes[e.name]=g}a.nodesPromise.resolve(a.nodes),b.get("/api/link/").success(function(b){angular.forEach(b,function(b){var c=b.nodes[0],d=b.nodes[1],e=i(c.name),g=i(d.name),j=b.bandwidth/5+2;j>10&&(j=10),f='<img style="width: 380px;"" src="/graph/bandwidth/'+c.name+"/"+d.name+'">',a.paths[c.name+"_"+d.name]={id:b._id,type:"polyline",weight:j,color:h[b.saturation],activeColor:h[b.saturation],saturation:b.saturation,label:{message:f},opacity:.9,name:c.name+"-"+d.name,distance:b.distance,nodes:[b.nodes[0].name,b.nodes[1].name],latlngs:[e,g],link:{n1:c,n2:d}},a.linksPromise.resolve(a.paths)})})})}]);var app=angular.module("gps");app.controller("NodeController",["$scope","$routeParams","$http","$window",function(a,b,c,d){angular.extend(a,{center:{lat:0,lng:0,zoom:1},layers:{baselayers:{googleHybrid:{name:"Google Hybrid",layerType:"HYBRID",type:"google"},osm:{name:"OpenStreetMap",url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",type:"xyz"}}},markers:{}}),a.$on("leafletDirectiveMarker.click",function(a,c){d.location.href="/#/node/"+b.node}),a.$on("$routeChangeSuccess",function(b,d){var e=d.params.node;c.get("/api/node/"+e).success(function(b){a.center={lat:b.lat,lng:b.lng,zoom:16},a.markers={main:{lat:b.lat,lng:b.lng,icon:{type:"awesomeMarker",icon:"fa-star",color:b.alive?"blue":"red",prefix:"fa",shape:"circle",labelAnchor:[10,-24]},label:{message:"<strong>"+b.name+"</strong>",direction:"auto",options:{noHide:!0}}}},a.node=b}),c.get("/api/node/"+e+"/links").success(function(b){var c={};for(var d in b){var f=b[d],g={};f.nodes[0].name!==e?g.name=f.nodes[0].name:g.name=f.nodes[1].name,g.distance=f.distance,c[g.name]=g}a.neighbors=c})})}]);var app=angular.module("gps"),saturationColor={0:"#491",1:"#FFFF00",2:"#FF8800",3:"#FF0000"};app.controller("LinkController",["$scope","$http","leafletBoundsHelpers","leafletData","$window",function(a,b,c,d,e){angular.extend(a,{center:{},layers:{baselayers:{googleHybrid:{name:"Google Hybrid",layerType:"HYBRID",type:"google"},osm:{name:"OpenStreetMap",url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",type:"xyz"}}},markers:{},bounds:{},paths:{}}),a.$on("leafletDirectivePath.click",function(a,b){e.location.href="/#/link/"+b.pathName.replace("_","/")}),a.$on("leafletDirectiveMarker.click",function(a,b){e.location.href="/#/node/"+b.name}),a.$on("$routeChangeSuccess",function(c,e){var f=e.params.n1,g=e.params.n2;b.get("/api/link/"+f+"/"+g).success(function(b){a.link=b.link,a.nodes=b.nodes,f=a.nodes[b.link.nodes[0].name],g=a.nodes[b.link.nodes[1].name];var c=b.link.bandwidth/5+2;c>10&&(c=10),a.paths[f.name+"_"+g.name]={weight:c,saturation:b.link.saturation,color:saturationColor[b.link.saturation],label:{message:"<p>"+b.link.distance+" meters</p>"},opacity:.9,latlngs:[{lat:f.lat,lng:f.lng},{lat:g.lat,lng:g.lng}]},a.markers={n1:{lat:f.lat,lng:f.lng,icon:{type:"awesomeMarker",icon:"fa-star",color:f.alive?"blue":"red",prefix:"fa",shape:"circle",labelAnchor:[10,-24]},label:{message:"<strong>"+f.name+"</strong>",direction:"auto",options:{noHide:!0}}},n2:{lat:g.lat,lng:g.lng,icon:{type:"awesomeMarker",icon:"fa-star",color:g.alive?"blue":"red",prefix:"fa",shape:"circle",labelAnchor:[10,-24]},label:{message:"<strong>"+g.name+"</strong>",direction:"auto",options:{noHide:!0}}}},d.getMap().then(function(a){a.fitBounds([[f.lat,f.lng],[g.lat,g.lng]])})})})}]);